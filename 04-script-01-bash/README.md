# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

## Обязательные задания

1. Есть скрипт:
	```bash
	a=1
	b=2
	c=a+b
	d=$a+$b
	e=$(($a+$b))
	```
	* Какие значения переменным c,d,e будут присвоены?
	* Почему?
    
    #### Решение:
    ```bash
    bash-3.2$ a=1
    bash-3.2$ b=2
    bash-3.2$ c=a+b
    bash-3.2$ d=$a+$b
    bash-3.2$ e=$(($a+$b))
    bash-3.2$ echo $c
    a+b # при присвоении не использовался знак $ для переменных и выражение a+b было воспринято как строка
    bash-3.2$ echo $d
    1+2 # переменные $a и $b были подставлены в текстовую строку
    bash-3.2$ echo $e
    3 # выражение в двойных круглых скобках воспринимается как арифметическое выражение над целыми числами
    ```

2. На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
	```bash
	while ((1==1)
	do
	curl https://localhost:4757
	if (($? != 0))
	then
	date >> curl.log
	fi
	done
	```
     
    #### Решение:
    В исходном скрипте допущена ошибка, заключающаяся в том что, не предусмотрено действий при доступности сервиса, нужно добавить блок `else` для оператора `if` и выйти из цикла либо завершить скрипт, например так:
	```bash
    while ((1==1))
    do
        curl https://localhost:4757
        if (($? != 0))
        then
            date >> curl.log
        else
            # сервис работает, выходим
            exit 0
            #break # можно использовать в данном случае вместо exit 0
        fi
    done
	``` 
 
3. Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.
     
    #### Решение:
	```bash
    #!/usr/bin/env bash
    hosts=(192.168.0.1 173.194.222.113 87.250.250.242)
    attempts=5
    
    for ip in "${hosts[@]}"
    do
        for (( n=1; n<="${attempts}"; n++ ))
        do
            curl -s -o /dev/null --connect-timeout 5 "http://${ip}:80"
            res=$?
            echo "$(date "+%D %T") - host: ${ip} - attempt: ${n} - exit code: ${res}"  >> curl.log
            if ((res==0)); then break; fi
        done
    done
	```
    Содержимое curl.log:
    ```
    10/05/22 19:07:02 - host: 192.168.0.1 - attempt: 1 - exit code: 28
    10/05/22 19:07:07 - host: 192.168.0.1 - attempt: 2 - exit code: 28
    10/05/22 19:07:12 - host: 192.168.0.1 - attempt: 3 - exit code: 28
    10/05/22 19:07:17 - host: 192.168.0.1 - attempt: 4 - exit code: 28
    10/05/22 19:07:22 - host: 192.168.0.1 - attempt: 5 - exit code: 28
    10/05/22 19:07:23 - host: 173.194.222.113 - attempt: 1 - exit code: 0
    10/05/22 19:07:23 - host: 87.250.250.242 - attempt: 1 - exit code: 0
    ```
4. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается
     
    #### Решение:
	```bash
    #!/usr/bin/env bash
    hosts=(192.168.0.1 173.194.222.113 87.250.250.242)
    attempts=5
    
    for ip in "${hosts[@]}"
    do
        res=0
        for (( n=1; n<="${attempts}"; n++ ))
        do
            curl -s -o /dev/null --connect-timeout 5 "http://${ip}:80"
            res=$?
            echo "$(date "+%D %T") - host: ${ip} - attempt: ${n} - exit code: ${res}"  >> curl.log
            if ((res==0)); then break; fi
        done
        if ((res!=0))
        then
            echo "${ip}" > error
            exit $res
        fi
    done
    ```
     Содержимое curl.log:
    ```
    10/05/22 19:13:03 - host: 192.168.0.1 - attempt: 1 - exit code: 28
    10/05/22 19:13:08 - host: 192.168.0.1 - attempt: 2 - exit code: 28
    10/05/22 19:13:13 - host: 192.168.0.1 - attempt: 3 - exit code: 28
    10/05/22 19:13:18 - host: 192.168.0.1 - attempt: 4 - exit code: 28
    10/05/22 19:13:23 - host: 192.168.0.1 - attempt: 5 - exit code: 28
    ```
    Содержимое файла Error:
    ```
    192.168.0.1
    ```
## Дополнительное задание (со звездочкой*) - необязательно к выполнению

Мы хотим, чтобы у нас были красивые сообщения для коммитов в репозиторий. Для этого нужно написать локальный хук для git, который будет проверять, что сообщение в коммите содержит код текущего задания в квадратных скобках и количество символов в сообщении не превышает 30. Пример сообщения: \[04-script-01-bash\] сломал хук.

